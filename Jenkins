pipeline {
    agent any
    triggers {
      pollSCM('* * * * 1-5')
    }
    environment {
        Docker_Password = credentials('Docker_Password')
         Docker_Username = credentials('Docker_Username')
    }
    stages {
        stage('Docker Build') {
            steps {
                // echo 'Build stage'
                script {
            get_branch = "env | grep GIT_BRANCH | awk -F / '{print \$NF}' | xargs echo -n"
            env.get_branch_exec=sh(returnStdout: true, script: get_branch)
          } 
          sh '''
            
            docker build -t venuzs/test:${get_branch_exec} .
          '''
        }
            }
        
        stage('Docker Push') {
            steps {
                 script {
            get_branch = "env | grep GIT_BRANCH | awk -F / '{print \$NF}' | xargs echo -n"
            env.get_branch_exec=sh(returnStdout: true, script: get_branch)
                 }
                sh '''
                 docker login -u ${Docker_Username} -p ${Docker_Password}
                docker push venuzs/test:${get_branch_exec} 
                '''
            }
        }
    }
}